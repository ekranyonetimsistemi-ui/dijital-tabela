<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>📺 Dijital Tabela - Görüntüleme Ekranı</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #000;
            color: white;
            overflow: hidden;
            cursor: none; /* Kiosk modu için fare imlecini gizle */
        }
        
        /* Ana konteyner */
        .display-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* İçerik alanı */
        .content-area {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #111;
        }
        
        /* Resim görünümü */
        .content-item {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 1s ease-in-out;
        }
        
        .content-item.active {
            display: flex;
            opacity: 1;
        }
        
        .content-item img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: 0;
        }
        
        .content-item video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        /* Bilgi paneli */
        .info-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px 20px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            z-index: 100;
            font-size: 14px;
            opacity: 0.7;
            transition: opacity 0.3s;
        }
        
        .info-panel:hover {
            opacity: 1;
        }
        
        /* Alt durum çubuğu */
        .status-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
            opacity: 0.8;
        }
        
        .screen-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .progress-bar {
            flex: 1;
            max-width: 300px;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            overflow: hidden;
            margin: 0 20px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        /* Saat */
        .clock {
            font-size: 24px;
            font-weight: 300;
            letter-spacing: 1px;
        }
        
        /* Bekleme ekranı */
        .waiting-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            z-index: 50;
        }
        
        .waiting-screen.hidden {
            display: none;
        }
        
        .waiting-logo {
            font-size: 8em;
            margin-bottom: 30px;
            animation: pulse 2s infinite;
        }
        
        .waiting-text {
            font-size: 2em;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .waiting-subtext {
            font-size: 1.2em;
            opacity: 0.8;
            text-align: center;
            margin-bottom: 40px;
        }
        
        /* Bağlantı durumu */
        .connection-status {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            backdrop-filter: blur(10px);
            z-index: 100;
        }
        
        .connection-status.online {
            background: rgba(39, 174, 96, 0.9);
        }
        
        .connection-status.offline {
            background: rgba(231, 76, 60, 0.9);
        }
        
        /* Loading animasyonu */
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        /* Fullscreen buton */
        .fullscreen-btn {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            z-index: 100;
            font-size: 16px;
            opacity: 0.7;
            transition: opacity 0.3s;
        }
        
        .fullscreen-btn:hover {
            opacity: 1;
        }
        
        /* Ekran kayıt modalı */
        .registration-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .registration-form {
            background: white;
            color: #333;
            padding: 40px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            text-align: center;
        }
        
        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #eee;
            border-radius: 8px;
            font-size: 16px;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .info-panel {
                top: 10px;
                right: 10px;
                padding: 10px 15px;
                font-size: 12px;
            }
            
            .status-bar {
                padding: 15px;
                flex-direction: column;
                gap: 10px;
            }
            
            .clock {
                font-size: 18px;
            }
            
            .waiting-logo {
                font-size: 4em;
            }
            
            .waiting-text {
                font-size: 1.5em;
            }
        }
        
        /* Gece modu */
        .night-mode {
            filter: brightness(0.7) contrast(1.1);
        }
        
        /* Ekran koruyucu */
        .screensaver {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 200;
        }
        
        .screensaver.active {
            display: flex;
        }
        
        .screensaver-content {
            text-align: center;
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <!-- Ekran Kayıt Modalı -->
    <div id="registrationModal" class="registration-modal" style="display: none;">
        <div class="registration-form">
            <h2 style="margin-bottom: 30px;">📺 Ekran Kaydı</h2>
            <p style="color: #666; margin-bottom: 30px;">Bu ekranı sisteme kaydetmek için bilgileri doldurun</p>
            
            <form id="screenRegistrationForm">
                <div class="form-group">
                    <label>Ekran Adı</label>
                    <input type="text" id="screenName" required placeholder="Örn: Mağaza Giriş Ekranı">
                </div>
                
                <div class="form-group">
                    <label>Konum</label>
                    <input type="text" id="screenLocation" required placeholder="Örn: İstanbul - Kadıköy Mağaza">
                </div>
                
                <div class="form-group">
                    <label>Grup</label>
                    <select id="screenGroup">
                        <option value="">Grup Seçin (Opsiyonel)</option>
                    </select>
                </div>
                
                <button type="submit" class="btn">✅ Ekranı Kaydet</button>
            </form>
        </div>
    </div>

    <!-- Ana Görüntüleme Alanı -->
    <div class="display-container">
        <!-- Bağlantı Durumu -->
        <div id="connectionStatus" class="connection-status offline">
            <span id="connectionIcon">🔴</span>
            <span id="connectionText">Bağlantı Kuruluyor...</span>
        </div>
        
        <!-- Bilgi Paneli -->
        <div class="info-panel">
            <div><strong>📺 Ekran ID:</strong> <span id="displayScreenId">Kayıt Edilmemiş</span></div>
            <div><strong>👥 Grup:</strong> <span id="displayGroup">-</span></div>
            <div><strong>📍 Konum:</strong> <span id="displayLocation">-</span></div>
            <div><strong>🔄 Son Güncelleme:</strong> <span id="lastUpdate">-</span></div>
        </div>
        
        <!-- İçerik Alanı -->
        <div class="content-area" id="contentArea">
            <!-- İçerikler buraya yüklenecek -->
        </div>
        
        <!-- Bekleme Ekranı -->
        <div id="waitingScreen" class="waiting-screen">
            <div class="waiting-logo">📺</div>
            <div class="waiting-text">Dijital Tabela Sistemi</div>
            <div class="waiting-subtext">İçerik yüklenmesi bekleniyor...</div>
            <div class="loading"></div>
        </div>
        
        <!-- Ekran Koruyucu -->
        <div id="screensaver" class="screensaver">
            <div class="screensaver-content">
                <div style="font-size: 4em; margin-bottom: 20px;">🌙</div>
                <div style="font-size: 1.5em;">Ekran Koruyucu Aktif</div>
                <div style="font-size: 1em; margin-top: 10px;">Devam etmek için tıklayın</div>
            </div>
        </div>
        
        <!-- Durum Çubuğu -->
        <div class="status-bar">
            <div class="screen-info">
                <span id="currentContentInfo">İçerik bekleniyor...</span>
                <span id="contentCounter">0/0</span>
            </div>
            
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            
            <div class="clock" id="clock">--:--</div>
        </div>
        
        <!-- Tam Ekran Butonu -->
        <button class="fullscreen-btn" id="fullscreenBtn" onclick="toggleFullscreen()">⛶</button>
    </div>

    <script>
        // Global değişkenler
        let currentScreenId = null;
        let currentContent = [];
        let currentIndex = 0;
        let slideInterval = null;
        let isRegistered = false;
        let connectionStatus = false;
        let screensaverTimeout = null;
        let lastActivity = Date.now();
        
        // Sistem konfigürasyonu
        const config = {
            slideInterval: 8000, // 8 saniye
            screensaverDelay: 300000, // 5 dakika
            updateInterval: 30000, // 30 saniye
            nightModeStart: 22, // 22:00
            nightModeEnd: 7, // 07:00
            adminUrl: window.location.origin // Admin paneli URL'si
        };

        // Sayfa yüklendiğinde
        window.addEventListener('load', () => {
            initializeDisplay();
        });

        // Görüntüleme sistemi başlatma
        async function initializeDisplay() {
            // URL parametrelerini kontrol et
            const urlParams = new URLSearchParams(window.location.search);
            const screenId = urlParams.get('id');
            
            if (screenId) {
                currentScreenId = screenId;
                await loadScreenData();
            } else {
                // Kayıtlı ekran ID'sini kontrol et
                const savedScreenId = localStorage.getItem('display_screen_id');
                if (savedScreenId) {
                    currentScreenId = savedScreenId;
                    await loadScreenData();
                } else {
                    showRegistrationModal();
                    return;
                }
            }
            
            // Sistem başlatma
            startClock();
            startContentSystem();
            setupEventListeners();
            updateConnectionStatus(true);
            startPeriodicUpdates();
            
            console.log('📺 Dijital Tabela Görüntüleme Sistemi Başlatıldı');
            console.log('🆔 Ekran ID:', currentScreenId);
        }

        // Ekran verilerini yükle
        async function loadScreenData() {
            try {
                // LocalStorage'dan sistem verilerini al
                const screens = JSON.parse(localStorage.getItem('digital_screens') || '[]');
                const groups = JSON.parse(localStorage.getItem('screen_groups') || '[]');
                
                const screen = screens.find(s => s.id === currentScreenId);
                
                if (screen) {
                    isRegistered = true;
                    document.getElementById('displayScreenId').textContent = screen.name;
                    document.getElementById('displayLocation').textContent = screen.location;
                    
                    const group = groups.find(g => g.id === screen.groupId);
                    document.getElementById('displayGroup').textContent = group ? group.name : 'Grup Yok';
                    
                    // Ekran durumunu güncelle
                    updateScreenStatus('online');
                    
                } else {
                    console.warn('⚠️ Ekran sisteme kayıtlı değil:', currentScreenId);
                    showRegistrationModal();
                }
                
            } catch (error) {
                console.error('❌ Ekran verileri yüklenirken hata:', error);
            }
        }

        // Kayıt modalını göster
        function showRegistrationModal() {
            // Mevcut grupları yükle
            const groups = JSON.parse(localStorage.getItem('screen_groups') || '[]');
            const groupSelect = document.getElementById('screenGroup');
            
            groupSelect.innerHTML = '<option value="">Grup Seçin (Opsiyonel)</option>';
            groups.forEach(group => {
                const option = document.createElement('option');
                option.value = group.id;
                option.textContent = group.name;
                groupSelect.appendChild(option);
            });
            
            document.getElementById('registrationModal').style.display = 'flex';
        }

        // Ekran kayıt formu
        document.getElementById('screenRegistrationForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const screenName = document.getElementById('screenName').value;
            const screenLocation = document.getElementById('screenLocation').value;
            const screenGroup = document.getElementById('screenGroup').value;
            
            // Yeni ekran ID'si oluştur
            currentScreenId = 'screen_' + Date.now();
            
            // Ekranı sisteme kaydet
            const screens = JSON.parse(localStorage.getItem('digital_screens') || '[]');
            const newScreen = {
                id: currentScreenId,
                name: screenName,
                location: screenLocation,
                groupId: screenGroup || null,
                status: 'online',
                lastSeen: new Date().toISOString(),
                description: 'Otomatik kayıt',
                created: new Date().toISOString()
            };
            
            screens.push(newScreen);
            localStorage.setItem('digital_screens', JSON.stringify(screens));
            localStorage.setItem('display_screen_id', currentScreenId);
            
            // Aktivite ekle
            const activities = JSON.parse(localStorage.getItem('system_activities') || '[]');
            activities.push({
                id: Date.now(),
                message: `Yeni ekran kendini kaydetti: ${screenName}`,
                time: new Date().toISOString()
            });
            localStorage.setItem('system_activities', JSON.stringify(activities));
            
            // Modalı kapat ve sistemi başlat
            document.getElementById('registrationModal').style.display = 'none';
            isRegistered = true;
            
            // Ekran bilgilerini güncelle
            document.getElementById('displayScreenId').textContent = screenName;
            document.getElementById('displayLocation').textContent = screenLocation;
            
            const groups = JSON.parse(localStorage.getItem('screen_groups') || '[]');
            const group = groups.find(g => g.id === screenGroup);
            document.getElementById('displayGroup').textContent = group ? group.name : 'Grup Yok';
            
            // Sistemi başlat
            startClock();
            startContentSystem();
            setupEventListeners();
            updateConnectionStatus(true);
            startPeriodicUpdates();
            
            console.log('✅ Ekran başarıyla kaydedildi:', screenName);
        });

        // İçerik sistemini başlat
        async function startContentSystem() {
            await loadContent();
            
            if (currentContent.length > 0) {
                hideWaitingScreen();
                startSlideshow();
            } else {
                showWaitingScreen();
                console.log('⏳ İçerik bekleniyor...');
            }
        }

        // İçerikleri yükle
        async function loadContent() {
            try {
                // Bu ekrana atanmış içerikleri al
                const assignments = JSON.parse(localStorage.getItem('content_assignments') || '{}');
                const uploadedFiles = JSON.parse(localStorage.getItem('uploadedFiles') || '[]');
                
                let assignedContent = [];
                
                // Direkt ekran ataması kontrol et
                if (assignments[currentScreenId]) {
                    assignedContent = assignments[currentScreenId];
                }
                
                // Grup ataması kontrol et
                const screens = JSON.parse(localStorage.getItem('digital_screens') || '[]');
                const screen = screens.find(s => s.id === currentScreenId);
                
                if (screen && screen.groupId && assignments[screen.groupId]) {
                    assignedContent = [...assignedContent, ...assignments[screen.groupId]];
                }
                
                // İçerikleri hazırla
                currentContent = assignedContent.map(assignment => {
                    const file = uploadedFiles[assignment.contentIndex];
                    if (file) {
                        return {
                            name: file.name,
                            type: file.type,
                            data: file.data,
                            size: file.size
                        };
                    }
                    return null;
                }).filter(item => item !== null);
                
                // Eğer atanmış içerik yoksa, tüm içerikleri göster (demo amaçlı)
                if (currentContent.length === 0 && uploadedFiles.length > 0) {
                    currentContent = uploadedFiles.map(file => ({
                        name: file.name,
                        type: file.type,
                        data: file.data,
                        size: file.size
                    }));
                }
                
                console.log('📂 İçerik yüklendi:', currentContent.length, 'adet');
                updateLastUpdateTime();
                
            } catch (error) {
                console.error('❌ İçerik yükleme hatası:', error);
                currentContent = [];
            }
        }

        // Slayt gösterisini başlat
        function startSlideshow() {
            if (currentContent.length === 0) {
                showWaitingScreen();
                return;
            }
            
            // Mevcut interval'ı temizle
            if (slideInterval) {
                clearInterval(slideInterval);
            }
            
            // İçerik alanını hazırla
            setupContentArea();
            
            // İlk içeriği göster
            showContent(0);
            
            // Otomatik geçiş başlat (eğer birden fazla içerik varsa)
            if (currentContent.length > 1) {
                slideInterval = setInterval(() => {
                    nextSlide();
                }, config.slideInterval);
            }
            
            console.log('🎬 Slayt gösterisi başladı');
        }

        // İçerik alanını hazırla
        function setupContentArea() {
            const contentArea = document.getElementById('contentArea');
            contentArea.innerHTML = '';
            
            currentContent.forEach((content, index) => {
                const contentDiv = document.createElement('div');
                contentDiv.className = 'content-item';
                contentDiv.id = `content-${index}`;
                
                if (content.type === 'image') {
                    const img = document.createElement('img');
                    img.src = content.data;
                    img.alt = content.name;
                    img.onload = () => console.log('🖼️ Resim yüklendi:', content.name);
                    contentDiv.appendChild(img);
                } else if (content.type === 'video') {
                    const video = document.createElement('video');
                    video.src = content.data;
                    video.muted = true;
                    video.loop = false;
                    video.playsInline = true;
                    video.onloadeddata = () => console.log('🎥 Video yüklendi:', content.name);
                    
                    // Video bittiğinde otomatik geçiş
                    video.onended = () => {
                        setTimeout(() => nextSlide(), 1000);
                    };
                    
                    contentDiv.appendChild(video);
                }
                
                contentArea.appendChild(contentDiv);
            });
        }

        // İçerik göster
        function showContent(index) {
            if (index < 0 || index >= currentContent.length) return;
            
            // Tüm içerikleri gizle
            document.querySelectorAll('.content-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Hedef içeriği göster
            const targetContent = document.getElementById(`content-${index}`);
            if (targetContent) {
                targetContent.classList.add('active');
                
                // Video ise oynat
                const video = targetContent.querySelector('video');
                if (video) {
                    video.currentTime = 0;
                    video.play().catch(e => console.log('Video otomatik oynatma engellendi'));
                }
            }
            
            currentIndex = index;
            updateContentInfo();
            updateProgress();
            
            console.log('📺 İçerik gösteriliyor:', currentContent[index].name);
        }

        // Sonraki slayt
        function nextSlide() {
            const nextIndex = (currentIndex + 1) % currentContent.length;
            showContent(nextIndex);
        }

        // Önceki slayt
        function prevSlide() {
            const prevIndex = currentIndex === 0 ? currentContent.length - 1 : currentIndex - 1;
            showContent(prevIndex);
        }

        // İçerik bilgisini güncelle
        function updateContentInfo() {
            if (currentContent.length > 0) {
                const current = currentContent[currentIndex];
                document.getElementById('currentContentInfo').textContent = 
                    `${current.name} (${current.type === 'image' ? '🖼️' : '🎥'})`;
                document.getElementById('contentCounter').textContent = 
                    `${currentIndex + 1}/${currentContent.length}`;
            } else {
                document.getElementById('currentContentInfo').textContent = 'İçerik bekleniyor...';
                document.getElementById('contentCounter').textContent = '0/0';
            }
        }

        // Progress bar güncelle
        function updateProgress() {
            if (currentContent.length <= 1) return;
            
            const progressFill = document.getElementById('progressFill');
            const progress = ((currentIndex + 1) / currentContent.length) * 100;
            progressFill.style.width = progress + '%';
        }

        // Bekleme ekranını göster
        function showWaitingScreen() {
            document.getElementById('waitingScreen').classList.remove('hidden');
        }

        // Bekleme ekranını gizle
        function hideWaitingScreen() {
            document.getElementById('waitingScreen').classList.add('hidden');
        }

        // Saati başlat
        function startClock() {
            function updateClock() {
                const now = new Date();
                const timeString = now.toLocaleTimeString('tr-TR', {
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
                document.getElementById('clock').textContent = timeString;
                
                // Gece modu kontrolü
                const hour = now.getHours();
                const body = document.body;
                
                if (hour >= config.nightModeStart || hour < config.nightModeEnd) {
                    body.classList.add('night-mode');
                } else {
                    body.classList.remove('night-mode');
                }
            }
            
            updateClock();
            setInterval(updateClock, 1000);
        }

        // Periyodik güncellemeleri başlat
        function startPeriodicUpdates() {
            setInterval(async () => {
                await loadContent();
                
                if (currentContent.length > 0 && document.getElementById('waitingScreen').classList.contains('hidden') === false) {
                    hideWaitingScreen();
                    startSlideshow();
                } else if (currentContent.length === 0) {
                    showWaitingScreen();
                    if (slideInterval) {
                        clearInterval(slideInterval);
                        slideInterval = null;
                    }
                }
                
                // Ekran durumunu güncelle
                updateScreenStatus('online');
                
            }, config.updateInterval);
        }

        // Ekran durumunu güncelle
        function updateScreenStatus(status) {
            if (!isRegistered) return;
            
            try {
                const screens = JSON.parse(localStorage.getItem('digital_screens') || '[]');
                const screenIndex = screens.findIndex(s => s.id === currentScreenId);
                
                if (screenIndex > -1) {
                    screens[screenIndex].status = status;
                    screens[screenIndex].lastSeen = new Date().toISOString();
                    localStorage.setItem('digital_screens', JSON.stringify(screens));
                }
            } catch (error) {
                console.error('❌ Ekran durumu güncellenemedi:', error);
            }
        }

        // Bağlantı durumunu güncelle
        function updateConnectionStatus(isOnline) {
            const statusEl = document.getElementById('connectionStatus');
            const iconEl = document.getElementById('connectionIcon');
            const textEl = document.getElementById('connectionText');
            
            if (isOnline) {
                statusEl.className = 'connection-status online';
                iconEl.textContent = '🟢';
                textEl.textContent = 'Bağlı';
                connectionStatus = true;
            } else {
                statusEl.className = 'connection-status offline';
                iconEl.textContent = '🔴';
                textEl.textContent = 'Bağlantı Yok';
                connectionStatus = false;
            }
        }

        // Son güncelleme zamanını güncelle
        function updateLastUpdateTime() {
            const now = new Date().toLocaleString('tr-TR');
            document.getElementById('lastUpdate').textContent = now;
        }

        // Event listener'ları kur
        function setupEventListeners() {
            // Klavye kontrolleri
            document.addEventListener('keydown', (e) => {
                resetActivity();
                
                switch(e.key) {
                    case 'ArrowRight':
                    case ' ':
                        e.preventDefault();
                        nextSlide();
                        break;
                    case 'ArrowLeft':
                        e.preventDefault();
                        prevSlide();
                        break;
                    case 'F11':
                        e.preventDefault();
                        toggleFullscreen();
                        break;
                    case 'r':
                    case 'R':
                        if (e.ctrlKey) {
                            e.preventDefault();
                            location.reload();
                        }
                        break;
                    case 'Escape':
                        if (document.fullscreenElement) {
                            document.exitFullscreen();
                        }
                        break;
                }
            });
            
            // Mouse aktivitesi
            document.addEventListener('mousemove', resetActivity);
            document.addEventListener('click', resetActivity);
            
            // Ekran koruyucu tıklama
            document.getElementById('screensaver').addEventListener('click', () => {
                deactivateScreensaver();
            });
            
            // Sayfa odak kontrolleri
            document.addEventListener('visibilitychange', () => {
                if (document.hidden) {
                    // Sayfa gizlendi
                    if (slideInterval) {
                        clearInterval(slideInterval);
                    }
                } else {
                    // Sayfa tekrar görünür
                    if (currentContent.length > 1) {
                        startSlideshow();
                    }
                }
            });
        }

        // Aktiviteyi sıfırla (ekran koruyucu için)
        function resetActivity() {
            lastActivity = Date.now();
            deactivateScreensaver();
            
            // Ekran koruyucu timeout'unu sıfırla
            if (screensaverTimeout) {
                clearTimeout(screensaverTimeout);
            }
            
            screensaverTimeout = setTimeout(() => {
                activateScreensaver();
            }, config.screensaverDelay);
        }

        // Ekran koruyucuyu aktifleştir
        function activateScreensaver() {
            document.getElementById('screensaver').classList.add('active');
            console.log('🌙 Ekran koruyucu aktif');
        }

        // Ekran koruyucuyu deaktifleştir
        function deactivateScreensaver() {
            document.getElementById('screensaver').classList.remove('active');
        }

        // Tam ekran toggle
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    console.log('Tam ekran desteklenmiyor:', err);
                });
            } else {
                document.exitFullscreen();
            }
        }

        // Sayfa kapatılırken temizlik
        window.addEventListener('beforeunload', () => {
            if (slideInterval) {
                clearInterval(slideInterval);
            }
            if (screensaverTimeout) {
                clearTimeout(screensaverTimeout);
            }
            
            // Ekran durumunu offline yap
            updateScreenStatus('offline');
        });

        // Konsol log'ları
        console.log('📺 Dijital Tabela Görüntüleme Sistemi v2.0');
        console.log('🔧 Konfigürasyon:', config);
        console.log('💡 Kontrollar:');
        console.log('  → Sağ Ok / Boşluk: Sonraki içerik');
        console.log('  ← Sol Ok: Önceki içerik');
        console.log('  F11: Tam ekran');
        console.log('  Ctrl+R: Yenile');
        
        // İlk aktivite sıfırlaması
        resetActivity();
    </script>
</body>
</html>
